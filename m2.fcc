variant: fcos
version: 1.5.0
passwd:
  users:
    - name: core
      ssh_authorized_keys_local:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDCbycUY5fyT86cgQhBzONGVM/D5m5Qw6ZprkF3iB6N3Kx7H3Lf21WraI/MoVLwI+2l7P47sTJk9FfwauOHRdkzlEbWNqKbrq7RPuKgET8AFl0J1KnEpauKqbcyGPfzzPq5JWSFZNTtxSYq3yPuAL8P/VNwk4sJLgGW3irUoCQxeS/H2VRzSgebJ/3dH6rnZUK1ydq7qb9JZ5lVpdEAKnvtq8fn+QbzwJ5u5bQ1p7mCGDWKXSauJa2hZaKrjch9VRYzm1BRnPwPdWUkZgXpoM56/XYVj3j3iEaquffCgEe9RPrAaW8jQ4oR0CpgECEkfFlFF+RI2LDvAokWws32GKbSFOf5hwj795A3G54t/AkzH6qYsExDIG1UFCYzWS+htL3clQzK7bzgzV8CgCxaEjoZIXZ7OcNDjdwdtJXuYPALaKK9Mokx1VTh9FEQktn2DlVswUisNLQsDSYd+58s+He6sFRPDa/jPBcu1w++1GEUV/M0O9h6FttuaPEdz31DID8= cchan@MSI"
systemd:
  units:
    - name: serial-getty@ttyS0.service
      dropins:
      - name: autologin-core.conf
        contents: |
          [Service]
          # Override Execstart in main unit
          ExecStart=
          # Add new Execstart with `-` prefix to ignore failure
          ExecStart=-/usr/sbin/agetty --autologin core --noclear %I $TERM
          TTYVTDisallocate=no
    - name: failure.service
      enabled: true
      contents: |
        [Service]
        Type=oneshot
        ExecStart=/usr/bin/false
        RemainAfterExit=yes

        [Install]
        WantedBy=multi-user.target
storage:
  files:
    - path: /etc/hostname
      mode: 0644
      contents:
        inline: |
          tutorial
    - path: /etc/profile.d/systemd-pager.sh
      mode: 0644
      contents:
        inline: |
          # Tell systemd to not use a pager when printing information
          export SYSTEMD_PAGER=cat
    - path: /etc/containers/systemd/etcd-member.container
      mode: 0644
      contents:
        inline: |
          [Unit]
          Description=Run a single node etcd
          After=network-online.target
          Wants=network-online.target

          [Container]
          ContainerName=etcd
          Image=quay.io/coreos/etcd:latest
          Network=host
          Volume=etcd-data:/etcd-data
          Exec=/usr/local/bin/etcd                                \
              --name node1 --data-dir /etcd-data                  \
              --initial-advertise-peer-urls http://127.0.0.1:2380 \
              --listen-peer-urls http://127.0.0.1:2380            \
              --advertise-client-urls http://127.0.0.1:2379       \
              --listen-client-urls http://127.0.0.1:2379          \
              --initial-cluster node1=http://127.0.0.1:2380

          [Install]
          WantedBy=multi-user.target
